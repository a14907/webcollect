<html lang=en-US><!--
 Page saved with SingleFile 
 url: http://cncc.bingj.com/cache.aspx?q=7-dangerous-mistakes-in-c-net-that-are-easy-to-make&d=4586462750575828&mkt=en-US&setlang=en-US&w=umqo7N4crzYlrvx3EBFOryBkyCPudMbz 
 saved date: Thu Apr 14 2022 11:05:17 GMT+0800 (中国标准时间)
--><meta charset=utf-8><style>.disclaimer{text-align:right;font-size:x-small}.banner{background-color:#fff;text-align:left}.cacheContent{position:relative}.b_vPanel>div{padding-bottom:10px}.b_vPanel>div:last-child{padding:0}.banner a{color:#001ba0}</style><meta http-equiv=origin-trial content="AxujKG9INjsZ8/gUq8+dTruNvk7RjZQ1oFhhgQbcTJKDnZfbzSTE81wvC2Hzaf3TW4avA76LTZEMdiedF1vIbA4AAABueyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0="><meta http-equiv=origin-trial content=Azuce85ORtSnWe1MZDTv68qpaW3iHyfL9YbLRy0cwcCZwVnePnOmkUJlG8HGikmOwhZU22dElCcfrfX2HhrBPAkAAAB7eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9><meta http-equiv=origin-trial content=A16nvcdeoOAqrJcmjLRpl1I6f3McDD8EfofAYTt/P/H4/AWwB99nxiPp6kA0fXoiZav908Z8etuL16laFPUdfQsAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9><meta http-equiv=origin-trial content=AxBHdr0J44vFBQtZUqX9sjiqf5yWZ/OcHRcRMN3H9TH+t90V/j3ENW6C8+igBZFXMJ7G3Pr8Dd13632aLng42wgAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9><meta http-equiv=origin-trial content="A88BWHFjcawUfKU3lIejLoryXoyjooBXLgWmGh+hNcqMK44cugvsI5YZbNarYvi3roc1fYbHA1AVbhAtuHZflgEAAAB2eyJvcmlnaW4iOiJodHRwczovL2dvb2dsZS5jb206NDQzIiwiZmVhdHVyZSI6IlRydXN0VG9rZW5zIiwiZXhwaXJ5IjoxNjUyNzc0NDAwLCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv=origin-trial content=A8FHS1NmdCwGqD9DwOicnHHY+y27kdWfxKa0YHSGDfv0CSpDKRHTQdQmZVPDUdaFWUsxdgVxlwAd6o+dhJykPA0AAACWeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9><meta http-equiv=origin-trial content=A8zdXi6dr1hwXEUjQrYiyYQGlU3557y5QWDnN0Lwgj9ePt66XMEvNkVWOEOWPd7TP9sBQ25X0Q15Lr1Nn4oGFQkAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9><meta http-equiv=origin-trial content=A4/Htern2udN9w3yJK9QgWQxQFruxOXsXL7cW60DyCl0EZFGCSme/J33Q/WzF7bBkVvhEWDlcBiUyZaim5CpFQwAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9><style data-fbcssmodules="css:fb.css.base css:fb.css.dialog css:fb.css.iframewidget css:fb.css.customer_chat_plugin_iframe">.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande",tahoma,verdana,arial,sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}@keyframes fb_mpn_landing_page_slide_out{0%{margin:0 12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;margin:0 24px;width:60px}}@keyframes fb_mpn_landing_page_slide_out_from_left{0%{left:12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;left:12px;width:60px}}@keyframes fb_mpn_landing_page_slide_up{0%{bottom:0;opacity:0}100%{bottom:24px;opacity:1}}@keyframes fb_mpn_bounce_in{0%{opacity:.5;top:100%}100%{opacity:1;top:0}}@keyframes fb_mpn_fade_out{0%{bottom:30px;opacity:1}100%{bottom:0;opacity:0}}@keyframes fb_mpn_bounce_out{0%{opacity:1;top:0}100%{opacity:.5;top:100%}}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0,0);transform-origin:bottom right}50%{transform:scale(1.03,1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1,1);transform-origin:bottom right}}@keyframes fb_bounce_in_from_left{0%{opacity:0;transform:scale(0,0);transform-origin:bottom left}50%{transform:scale(1.03,1.03);transform-origin:bottom left}100%{opacity:1;transform:scale(1,1);transform-origin:bottom left}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1,1);transform-origin:bottom right}100%{opacity:0;transform:scale(0,0);transform-origin:bottom right}}@keyframes fb_bounce_out_from_left{0%{opacity:1;transform:scale(1,1);transform-origin:bottom left}100%{opacity:0;transform:scale(0,0);transform-origin:bottom left}}@keyframes slideInFromBottom{0%{opacity:.1;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}@keyframes slideInFromBottomDelay{0%{opacity:0;transform:translateY(100%)}97%{opacity:0;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}</style><meta name=viewport content="width=device-width, initial-scale=1" class=sf-hidden><title class=sf-hidden>7 dangerous mistakes in C#/.NET that are easy to make – Blog&lt;T&gt;</title><meta name=generator content="WordPress 5.0.16" class=sf-hidden><meta name="specificfeeds-verification-code-ZzdZSjZabnh0K1pPdFdIc3Ftb2pDa1hiTUk3OFI1dnJaR2VaQ1ZOQTIvWVU2cnJpMWFZcWYyL0t5VGZFQUZZVFRqZm9HNXZRZVMzcWttN3RMVEtlL0ZyY1NrVU93OHM0MjM2dlY0NWpyVlYrV1VXR3ZiN0p4QUwvT1BBTEVjajF8eHRhUEdic0c2elM0enNjTWkvNGFPVFkwYVhLSytZNy9Fd2RqYjlTL1BqUT0=" content=RY37f1U2jDGF3M3MnsE9 class=sf-hidden><meta name=viewport content="width=device-width, initial-scale=1" class=sf-hidden><meta property=og:image:secure_url content=https://chrisstclair.co.uk/wp-content/uploads/2019/09/img_1637.jpg data-id=sfsi class=sf-hidden><meta property=og:image:type content=image/jpeg data-id=sfsi class=sf-hidden><meta property=og:image:width content=5184 data-id=sfsi class=sf-hidden><meta property=og:image:height content=3456 data-id=sfsi class=sf-hidden><meta property=og:url content=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ data-id=sfsi class=sf-hidden><meta property=og:description content="
C# is a great language, and the .NET Framework is pretty damn good too. C#'s strong typing reduces the amount of bugs that you'll create when compared to other languages. Plus its general common sense design helps a lot, when compared to something like JavaScript (where true is false). Nevertheless, in every language there are traps that easy to fall to and misconceptions on the expected behavior of the language and framework, and I'll detail some of these below



1. Not understanding deferred execution



I imagine seasoned developers are well aware of this .NET feature, but it can really bite developers who are unaware. In short, methods/statements that return IEnumerable<T> and yield each result are not executed on the line of code that actually calls it - they are executed&nbsp;when the resulting collection is accessed in some way*. Note that most LINQ statements will end up 'yielding' its results.



As an example, see the below unapologetically contrived unit test



[TestMethod]
[ExpectedException(typeof(ArgumentNullException))]
public void Ensure_Null_Exception_Is_Thrown()
{
    var result = RepeatString5Times(null);
}
[TestMethod]
[ExpectedException(typeof(InvalidOperationException))]
public void Ensure_Invalid_Operation_Exception_Is_Thrown()
{
    var result = RepeatString5Times(test);
    var firstItem = result.First();
}
private IEnumerable<string> RepeatString5Times(string toRepeat)
{
    if (toRepeat == null)
        throw new ArgumentNullException(nameof(toRepeat));
    for (int i = 0; i < 5; i++)
    {    
        if (i == 3)
             throw new InvalidOperationException(3 is a horrible number);
        yield return ${toRepeat} - {i};
    }
}



Both of these tests will fail. The first test will fail because the result is never accessed, so the body of the method is never called. The second test will fail for a different, slightly more complicated reason. We now retrieve the first result of our method call, to ensure that the method is actually being accessed. However, the deferred execution mechanism will exit from the method when it needs to - so in this case, we only want the first one, so once we yield the the first iteration the method halts its execution (so i == 3 is never true)



Deferred execution is actually a great feature, especially because it allows you to chain LINQ queries easily, only retrieving the data once your query is ready to be accessed.



2. Assuming the Dictionary type keeps items in the same order as you add them



This is a particularly nasty one, and I'm pretty sure I have some code out there that makes this assumption. When you add items to a List<T>, the items are kept in the same order as you add them - great. Sometimes you need to have another object associated with an item in a list, and the obvious answer is to use a Dictionary<TKey,TValue>, which allows you to specify an associated value to a key.



You can then iterate through the dictionary using foreach, and most of the time it will behave as would expect - you'll be accessing the items in the same order as they are added to the dictionary. However, this behavior is  undefined&nbsp;- i.e. is a happy coincidence rather than something you should assume and expect. This is explained in Microsoft's documentation but I imagine not a lot of people will be looking at this page.



To illustrate, in the below example the output is thirdsecond 



var dict = new Dictionary<string, object>();        
dict.Add(first, new object());
dict.Add(second, new object());
dict.Remove(first);
dict.Add(third, new object());
foreach (var entry in dict)
{
     Console.WriteLine(entry.Key);
}



Don't believe me? Try it online here



3. Not considering thread safety



Multithreading is great (citation needed), there can be some huge performance improvements to your application if implemented correctly. However, once you introduce multithreading you have to be very, very careful with any objects you'll be modifying because you'll start to encounter seemingly random bugs unless you're careful.



Simply put, a lot of common classes in the .NET library are not thread&nbsp;safe&nbsp;-&nbsp;this means that Microsoft provide no guarantees that you're able to use the given class in parallel using multiple threads. This wouldn't be much of a problem if you were able to discover any problems immediately, but the nature of multithreading means that any problems that arise are very volatile and unpredictable - it's likely no two executions will yield the same result.



As an example, take this block of code that uses the humble, but not thread safe, List<T> 



var items = new List<int>();
var tasks = new List<Task>();
for (int i = 0; i < 5; i++)
{
	tasks.Add(Task.Run(() => {
		for (int k = 0; k < 10000; k++)
		{
			items.Add(i);
		}
	}));
}
Task.WaitAll(tasks.ToArray());
Console.WriteLine(items.Count);



So we're adding numbers from 0-4 to a list 10000 times each, which means the list should contain 50000 items. Does it? Well, there's a small chance it will - but below are my results after running 5 times



2819123536443464000740476



You can try it online yourself here



Essentially, this is because the Add method isn’t atomic, which essentially means that a thread can ‘interrupt’ the method can end up resizing the array while another thread is in the process of adding, or adding at the same index as another thread. A couple of times I was presented with an IndexOutOfRange exception, likely because the array was being resized while I was adding to it. So what we do we here? We could use the 'lock' keyword to ensure only one thread can Add to the list at a time, but this can significantly impact performance. Microsoft, being the helpful folk they are, provide some awesome collections that are thread safe, and highly optimised for performance. I've published an article describing how you can use these here 



 4.&nbsp;Overuse&nbsp;of&nbsp;lazy&nbsp;loading&nbsp;in LINQ



Lazy loading is a great feature of both LINQ to SQL and LINQ to Entities (Entity Framework) that allows related table rows to be loaded on demand. In one of my other projects, I have a table called Modules and a table called Results, with a one to many relationship (a module can have many results)







When I want to retrieve a certain module, I would certainly not want Entity Framework to bring back every 'Result' that the Module has! So, it's clever enough that it would only execute the query to retrieve the results when I need to. So the below code would execute 2 queries - one to get the module, and another to get the results (for each module)



using (var db = new DBEntities())
{
    var modules = db.Modules;
    foreach (var module in modules)
    {
        var moduleType = module.Results;
        //Do something with module here
    }
}



However, what if I have hundreds of modules? That means a separate SQL query to get the Results records will execute for&nbsp;each&nbsp;Module! Clearly this is going to put a strain on the server and is going to considerably slow down your application. In Entity Framework, the answer is very simple - you can tell it to include a certain result set in your query. See below modified code, where there will only be one SQL query executed, which will include every module, and every result for that module (flattened to one query, which Entity Framework intelligently maps to your model)



using (var db = new DBEntities())
{
    var modules = db.Modules.Include(b => b.Results);
    foreach (var module in modules)
    {
        var moduleType = module.Results;
        //Do something with module here
    }
}



5. Not understanding how LINQ to SQL/Entity Frameworks translates queries



While I'm on the subject of LINQ, I feel it's worth mentioning how different your code will execute if it's inside a LINQ query. As a top level explanation, all of your code inside a LINQ query is translated to SQL using expressions - seems obvious, but it's very, very easy to forgot the context your in and end up introducing some issues to your codebase. I've made the below list to describe some of the common roadblocks you may come into.



Most method calls will not work



So imagine you have the below query, to split the name of all Modules by the colon character and grab the second portion.



 var modules = from m in db.Modules
               select m.Name.Split(':')[1];



This will throw an exception in most LINQ providers - there is no SQL translation for the 'Split' method, Certain methods may be supported, such as adding days to a date, but it all depends on your provider.



The ones that do work may produce unexpected results...



Take the below LINQ statement (I have no idea why you would do this in practice, but please just pretend it's a sensible query)



int modules = db.Modules.Sum(a => a.ID);



If you have any Module rows in the table, that will give you the sum of the IDs. Sounds about right! But what if you execute it using LINQ to Objects instead? We can do this by converting the Modules collection to a list before we execute our Sum method



int modules = db.Modules.ToList().Sum(a => a.ID);



Shock, horror - this does the exact same thing! However, what if you had no rows in the Modules table? The LINQ to Objects would return 0, and the Entity Framework/LINQ to SQL version will throw an InvalidOperationException saying that it cannot convert 'int?' to 'int'...not good. This is because when you perform a SUM in SQL on an empty set, you get NULL returned instead of 0 - hence it tries to return a nullable int instead. There's some guidance on how fix it here, if you encounter this problem.



Knowing when to just use plain old SQL



If you're performing an extraordinarily complicated query, then your translated query may end up looking like something that has been vomited, swallowed again and re-vomitted. Unfortunately I don't have any examples to hand, but based on my anecdotal evidence, it seems to really like using nested derived tables, which makes maintenance a nightmare.



Also, if you come across any performance bottlenecks, you're going to have a hard time improving them as you do not have direct control over the generated SQL. Either do it in SQL, or delegate it to a DBA if you have one if your company!



6. Rounding incorrectly



Now for something a bit simpler than the previous points, but one that I used to always forget about and end up with some nasty bugs (and if it involves financial values, prefer for an angry financial director/CEO). 



The .NET framework includes a lovely static method in the Math class called Round, which takes a numeric value and rounds to a given decimal places. Works perfectly most of the time, but what about when you are trying to round 2.25 to 1dp? I imagine you probably expect it to round to 2.3 - that's why we all taught, right? Well, it turns out that  .NET uses bankers&nbsp;rounding, which would round the given example to 2.2! This is because bankers rounding rounds to the nearest even number if the number is at the 'midpoint'. Luckily, this can be overridden in the Math.Round method with ease



Math.Round(2.25,1, MidpointRounding.AwayFromZero)



7. The horrible 'DBNull' class



This may bring back painful memories for some - ORM's hide this nastiness from us, but if you delve into the world of raw ADO.NET (SqlDataReader's and the like) you'll come across the DBNull.Value value. 



I'm not 100% sure of the reason why NULL values from the database are handled like this (please comment below if you know!), but Microsoft chose to represent them with a special type, DBNull (with the static Value field). I can think of one advantage of this - you won't get any nasty NullReferenceException exceptions when accessing a database field that is NULL. However, not only do you have to maintain a secondary way of checking for NULL values (which can easily be forgotten which would lead to major bugs), but you lose any of the lovely C# language features that help dealing with nulls. What could be as easy as 



reader.GetString(0) ?? NULL;



becomes...



reader.GetString(0) != DBNull.Value ? reader.GetString(0) : NULL;



Yuck.



Footnotes



These are just some of the unusual 'gotchas' I've come across in .NET - if you know any more, I'd love to hear from you below 



 
" data-id=sfsi class=sf-hidden><meta property=og:title content="7 dangerous mistakes in C#/.NET that are easy to make" data-id=sfsi class=sf-hidden><link type=image/x-icon rel="shortcut icon" href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><style>.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><body class="post-template-default single single-post postid-191 single-format-standard blog-grid-layout"><div class=banner><div class=b_vPanel><div>You have reached the cached page for <strong><a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ h="ID=SERP,5003.1">https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/</a></strong></div><div>Below is a snapshot of the Web page as it appeared on <strong>2022/4/3</strong> (the last time our crawler visited it). This is the version of the page that was used for ranking your search results. The page may have changed since we last cached it. To see what might have changed (without the highlights), <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ h="ID=SERP,5003.2">go to the current page</a>.</div><div><div class=disclaimer>Bing is not responsible for the content of this page.</div></div></div></div><div class=cacheContent>
<link rel=profile href=http://gmpg.org/xfn/11 class=sf-hidden>
<link rel=alternate type=application/rss+xml title="Blog<T> » Feed" href=https://chrisstclair.co.uk/feed/ class=sf-hidden>
<link rel=alternate type=application/rss+xml title="Blog<T> » Comments Feed" href=https://chrisstclair.co.uk/comments/feed/ class=sf-hidden>
<link rel=alternate type=application/rss+xml title="Blog<T> » 7 dangerous mistakes in C#/.NET that are easy to make Comments Feed" href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/feed/ class=sf-hidden>
 
 
<link rel=https://api.w.org/ href=https://chrisstclair.co.uk/wp-json/ class=sf-hidden>
<link rel=EditURI type=application/rsd+xml title=RSD href=https://chrisstclair.co.uk/xmlrpc.php?rsd class=sf-hidden>
<link rel=wlwmanifest type=application/wlwmanifest+xml href=https://chrisstclair.co.uk/wp-includes/wlwmanifest.xml class=sf-hidden> 
<link rel=prev title="Demystifying Async/Await" href=https://chrisstclair.co.uk/demystifying-async-await/ class=sf-hidden>
<link rel=next title="Unit testing – Making existing code testable" href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/ class=sf-hidden>
<link rel=canonical href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ class=sf-hidden>
<link rel=shortlink href="https://chrisstclair.co.uk/?p=191" class=sf-hidden>
<link rel=alternate type=application/json+oembed href="https://chrisstclair.co.uk/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fchrisstclair.co.uk%2F7-dangerous-mistakes-in-c-net-that-are-easy-to-make%2F" class=sf-hidden>
<link rel=alternate type=text/xml+oembed href="https://chrisstclair.co.uk/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fchrisstclair.co.uk%2F7-dangerous-mistakes-in-c-net-that-are-easy-to-make%2F&amp;format=xml" class=sf-hidden>
<link rel=pingback href=https://chrisstclair.co.uk/xmlrpc.php class=sf-hidden>
 <style class=sf-hidden>.recentcomments a{display:inline!important;padding:0!important;margin:0!important}</style>
 <style id=wp-custom-css class=sf-hidden>.site-title{font-family:monospace;font-size:3rem}.site-title a:link,.site-title a:visited{color:#C1242C!important}</style>
 
 <div id=page class=site>
 <a class="skip-link screen-reader-text" href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/#content>Skip to content</a>
 
 <header id=masthead class="site-header clearfix" role=banner>
 <div class="header-main container clearfix">
 <div id=logo class="site-branding clearfix">
 
 <p class=site-title><a href=https://chrisstclair.co.uk/ rel=home>Blog&lt;T&gt;</a></p>
 
 <p class=site-description>C# and ASP.NET blog by Chris St Clair</p>
 
 </div>
 
 </div>
 
<div id=main-navigation-wrap class=primary-navigation-wrap>
 <div id=main-navigation-container class="primary-navigation-container container">
 
 <nav id=main-navigation class="primary-navigation navigation clearfix" role=navigation>
 <ul id=menu-main class=main-navigation-menu><li id=menu-item-86 class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-86"><a href=https://chrisstclair.co.uk/category/extension-methods/>Extension Methods</a></li>
</ul> </nav>
 </div>
</div>
 
 
 </header>
 <div id=content class="site-content container">
 <div id=primary class=content-area>
 <main id=main class=site-main>
 
<article id=post-191 class="post-191 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized tag-c tag-linq">
 
 <div class=post-image>
 <img width=1360 height=765 src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt> </div>
 
 <div class=post-content>
 <header class=entry-header>
 <h1 class=entry-title>7 dangerous mistakes in C#/.NET that are easy to make</h1>
 <div class="entry-meta post-details"><span class="posted-on meta-date">Posted on <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ rel=bookmark><time class="entry-date published" datetime=2019-09-24T15:53:56+00:00>September 24, 2019</time><time class=updated datetime=2019-09-25T08:30:46+00:00>September 25, 2019</time></a></span><span class="posted-by meta-author"> by <span class="author vcard"><a class="url fn n" href=https://chrisstclair.co.uk/author/Chris/ title="View all posts by Chris" rel=author>Chris</a></span></span></div>
 </header>
 <div class="entry-content clearfix">
 
<p>C# is a <a href=https://medium.com/sololearn/why-is-c-among-the-most-popular-programming-languages-in-the-world-ccf26824ffcb>great language</a>, and the .NET Framework is pretty damn good too. C#’s strong typing reduces the amount of bugs that you’ll create when compared to other languages. Plus its general common sense design helps a lot, when compared to something like JavaScript (where <a href=https://github.com/denysdovhan/wtfjs#true-is-false>true is false</a>). Nevertheless, in every language there are traps that easy to fall to and misconceptions on the expected behavior of the language and framework, and I’ll detail some of these below</p>
<h2>1. Not understanding deferred execution</h2>
<p style=text-align:left><p class=has-text-align-left>I imagine seasoned developers are well aware of this .NET feature, but it can really bite developers who are unaware. In short, methods/statements that return IEnumerable&lt;T&gt; and <em>yield</em> each result are not executed on the line of code that actually calls it – they are executed<strong>&nbsp;</strong>when the resulting collection is accessed in some way<strong>*</strong>. Note that most LINQ statements will end up ‘yielding’ its results.<p></p>
<p>As an example, see the below unapologetically contrived unit test</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>[TestMethod]
[ExpectedException(typeof(ArgumentNullException))]
public void Ensure_Null_Exception_Is_Thrown()
{
    var result = RepeatString5Times(null);
}
[TestMethod]
[ExpectedException(typeof(InvalidOperationException))]
public void Ensure_Invalid_Operation_Exception_Is_Thrown()
{
    var result = RepeatString5Times("test");
    var firstItem = result.First();
}
private IEnumerable&lt;string&gt; RepeatString5Times(string toRepeat)
{
    if (toRepeat == null)
        throw new ArgumentNullException(nameof(toRepeat));
    for (int i = 0; i &lt; 5; i++)
    {    
        if (i == 3)
             throw new InvalidOperationException("3 is a horrible number");
        yield return $"{toRepeat} - {i}";
    }
}</pre>
<p>Both of these tests will fail. The first test will fail because the result is never accessed, so the body of the method is never called. The second test will fail for a different, slightly more complicated reason. We now retrieve the first result of our method call, to ensure that the method is actually being accessed. However, the deferred execution mechanism will exit from the method when it needs to – so in this case, we only want the first one, so once we yield the the first iteration the method halts its execution (so i == 3 is never true)</p>
<p>Deferred execution is actually a great feature, especially because it allows you to chain LINQ queries easily, only retrieving the data once your query is ready to be accessed.</p>
<h2>2. Assuming the Dictionary type keeps items in the same order as you add them</h2>
<p>This is a particularly nasty one, and I’m pretty sure I have some code out there that makes this assumption. When you add items to a List&lt;T&gt;, the items are kept in the same order as you add them – great. Sometimes you need to have another object associated with an item in a list, and the obvious answer is to use a Dictionary&lt;TKey,TValue&gt;, which allows you to specify an associated value to a key.</p>
<p>You can then iterate through the dictionary using foreach, and most of the time it will behave as would expect – you’ll be accessing the items in the same order as they are added to the dictionary. However, this behavior is <strong>undefined&nbsp;</strong>– i.e. is a happy coincidence rather than something you should assume and expect. This is explained in <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2?view=netframework-4.8">Microsoft’s documentation</a> but I imagine not a lot of people will be looking at this page.</p>
<p>To illustrate, in the below example the output is <br><br><em>third<br>second</em> </p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>var dict = new Dictionary&lt;string, object&gt;();        
dict.Add("first", new object());
dict.Add("second", new object());
dict.Remove("first");
dict.Add("third", new object());
foreach (var entry in dict)
{
     Console.WriteLine(entry.Key);
}</pre>
<p>Don’t believe me? <a href=https://dotnetfiddle.net/cv49I2>Try it online here</a></p>
<h2>3. Not considering thread safety</h2>
<p>Multithreading is great (citation needed), there can be some huge performance improvements to your application if implemented correctly. However, once you introduce multithreading you have to be very, very careful with any objects you’ll be modifying because you’ll start to encounter seemingly random bugs unless you’re careful.</p>
<p>Simply put, a lot of common classes in the .NET library are not <strong>thread&nbsp;safe&nbsp;</strong>–&nbsp;this means that Microsoft provide no guarantees that you’re able to use the given class in parallel using multiple threads. This wouldn’t be much of a problem if you were able to discover any problems immediately, but the nature of multithreading means that any problems that arise are very volatile and unpredictable – it’s likely no two executions will yield the same result.</p>
<p>As an example, take this block of code that uses the humble, but not thread safe, List&lt;T&gt; </p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>var items = new List&lt;int&gt;();
var tasks = new List&lt;Task&gt;();
for (int i = 0; i &lt; 5; i++)
{
	tasks.Add(Task.Run(() =&gt; {
		for (int k = 0; k &lt; 10000; k++)
		{
			items.Add(i);
		}
	}));
}
Task.WaitAll(tasks.ToArray());
Console.WriteLine(items.Count);</pre>
<p>So we’re adding numbers from 0-4 to a list 10000 times each, which means the list should contain <strong>50000</strong> items. Does it? Well, there’s a small chance it will – but below are my results after running 5 times</p>
<pre class=wp-block-preformatted>28191<br>23536<br>44346<br>40007<br>40476<br></pre>
<p>You can <a href=https://dotnetfiddle.net/me4Nm4>try it online yourself here</a></p>
<p>Essentially, this is because the Add method isn’t atomic, which essentially means that a thread can ‘interrupt’ the method can end up resizing the array while another thread is in the process of adding, or adding at the same index as another thread. A couple of times I was presented with an IndexOutOfRange exception, likely because the array was being resized while I was adding to it. So what we do we here? We could use the ‘lock’ keyword to ensure only one thread can Add to the list at a time, but this can significantly impact performance. Microsoft, being the helpful folk they are, provide some awesome collections that <strong>are</strong> thread safe, and highly optimised for performance. I’ve published an <a href=https://chrisstclair.co.uk/multithreading-made-easy-parallel-foreach/>article describing how you can use these here</a> </p>
<h2> <strong>4.&nbsp;Overuse&nbsp;of&nbsp;lazy&nbsp;loading&nbsp;in LINQ</strong></h2>
<p>Lazy loading is a great feature of both LINQ to SQL and LINQ to Entities (Entity Framework) that allows related table rows to be loaded on demand. In one of my other projects, I have a table called <strong>Modules</strong> and a table called <strong>Results</strong>, with a one to many relationship (a module can have many results)</p>
<figure class="wp-block-image is-resized"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt class=wp-image-196 width=247 height=316 srcset sizes data-sf-original-srcset="https://chrisstclair.co.uk/wp-content/uploads/2019/09/image.png 362w, https://chrisstclair.co.uk/wp-content/uploads/2019/09/image-235x300.png 235w"></figure>
<p>When I want to retrieve a certain module, I would certainly not want Entity Framework to bring back every ‘Result’ that the Module has! So, it’s clever enough that it would only execute the query to retrieve the results when I need to. So the below code would execute 2 queries – one to get the module, and another to get the results (for each module)</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>using (var db = new DBEntities())
{
    var modules = db.Modules;
    foreach (var module in modules)
    {
        var moduleType = module.Results;
        //Do something with module here
    }
}</pre>
<p>However, what if I have hundreds of modules? That means a separate SQL query to get the Results records will execute <strong>for&nbsp;each&nbsp;Module! </strong>Clearly this is going to put a strain on the server and is going to considerably slow down your application. In Entity Framework, the answer is very simple – you can tell it to include a certain result set in your query. See below modified code, where there will only be one SQL query executed, which will include every module, and every result for that module (flattened to one query, which Entity Framework intelligently maps to your model)</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>using (var db = new DBEntities())
{
    var modules = db.Modules.Include(b =&gt; b.Results);
    foreach (var module in modules)
    {
        var moduleType = module.Results;
        //Do something with module here
    }
}</pre>
<h2>5. Not understanding how LINQ to SQL/Entity Frameworks translates queries</h2>
<p>While I’m on the subject of LINQ, I feel it’s worth mentioning how different your code will execute if it’s inside a LINQ query. As a top level explanation, all of your code inside a LINQ query is translated to SQL using <a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/expressions>expressions</a> – seems obvious, but it’s very, very easy to forgot the context your in and end up introducing some issues to your codebase. I’ve made the below list to describe some of the common roadblocks you may come into.</p>
<h3>Most method calls will not work</h3>
<p>So imagine you have the below query, to split the name of all Modules by the colon character and grab the second portion.</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group> var modules = from m in db.Modules
               select m.Name.Split(':')[1];</pre>
<p>This will throw an exception in most LINQ providers – there is no SQL translation for the ‘Split’ method, Certain methods <em>may</em> be supported, such as adding days to a date, but it all depends on your provider.</p>
<h3>The ones that do work may produce unexpected results…</h3>
<p>Take the below LINQ statement (I have no idea why you would do this in practice, but please just pretend it’s a sensible query)</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>int modules = db.Modules.Sum(a =&gt; a.ID);</pre>
<p>If you have any Module rows in the table, that will give you the sum of the IDs. Sounds about right! But what if you execute it using LINQ to Objects instead? We can do this by converting the Modules collection to a list before we execute our Sum method</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>int modules = db.Modules.ToList().Sum(a =&gt; a.ID);</pre>
<p>Shock, horror – this does the exact same thing! However, what if you had no rows in the Modules table? The LINQ to Objects would return 0, and the Entity Framework/LINQ to SQL version will throw an <strong>InvalidOperationException</strong> saying that it cannot convert ‘int?’ to ‘int’…not good. This is because when you perform a SUM in SQL on an empty set, you get NULL returned instead of 0 – hence it tries to return a nullable int instead. There’s some <a href=https://stackoverflow.com/questions/776269/why-am-i-getting-an-invalidoperationexception-with-this-linq-to-sql-method>guidance on how fix it here, if you encounter this problem.</a></p>
<h3>Knowing when to just use plain old SQL</h3>
<p>If you’re performing an extraordinarily complicated query, then your translated query may end up looking like something that has been vomited, swallowed again and re-vomitted. Unfortunately I don’t have any examples to hand, but based on my anecdotal evidence, it seems to really like using nested derived tables, which makes maintenance a nightmare.</p>
<p>Also, if you come across any performance bottlenecks, you’re going to have a hard time improving them as you do not have direct control over the generated SQL. Either do it in SQL, or delegate it to a DBA if you have one if your company!</p>
<h2>6. Rounding incorrectly</h2>
<p>Now for something a bit simpler than the previous points, but one that I used to always forget about and end up with some nasty bugs (and if it involves financial values, prefer for an angry financial director/CEO). </p>
<p>The .NET framework includes a lovely static method in the <strong>Math</strong> class called <strong>Round</strong>, which takes a numeric value and rounds to a given decimal places. Works perfectly most of the time, but what about when you are trying to round 2.25 to 1dp? I imagine you probably expect it to round to 2.3 – that’s why we all taught, right? Well, it turns out that .NET uses <a href=http://www.xbeat.net/vbspeed/i_BankersRounding.htm>bankers&nbsp;rounding</a>, which would round the given example to 2.2! This is because bankers rounding rounds to the nearest even number if the number is at the ‘midpoint’. Luckily, this can be overridden in the Math.Round method with ease</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>Math.Round(2.25,1, MidpointRounding.AwayFromZero)</pre>
<h2>7. The horrible ‘DBNull’ class</h2>
<p>This may bring back painful memories for some – ORM’s hide this nastiness from us, but if you delve into the world of raw ADO.NET (SqlDataReader’s and the like) you’ll come across the DBNull.Value value. </p>
<p>I’m not 100% sure of the reason <em>why</em> NULL values from the database are handled like this (please comment below if you know!), but Microsoft chose to represent them with a special type, DBNull (with the static Value field). I can think of one advantage of this – you won’t get any nasty NullReferenceException exceptions when accessing a database field that is NULL. However, not only do you have to maintain a secondary way of checking for NULL values (which can easily be forgotten which would lead to major bugs), but you lose any of the lovely C# language features that help dealing with nulls. What could be as easy as </p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>reader.GetString(0) ?? "NULL";</pre>
<p>becomes…</p>
<pre class=EnlighterJSRAW data-enlighter-language=csharp data-enlighter-theme data-enlighter-highlight data-enlighter-linenumbers data-enlighter-lineoffset data-enlighter-title data-enlighter-group>reader.GetString(0) != DBNull.Value ? reader.GetString(0) : "NULL";</pre>
<p>Yuck.</p>
<h2>Footnotes</h2>
<p>These are just some of the unusual ‘gotchas’ I’ve come across in .NET – if you know any more, I’d love to hear from you below </p>
<p> </p>
<div class=sfsi_Sicons style=width:100%;display:inline-block;vertical-align:middle;text-align:left><div style="margin:0px 8px 0px 0px;line-height:24px"><span></span></div><div class=sfsi_socialwpr><div class=sf_subscrbe style=text-align:left;vertical-align:middle;float:left;width:64px><a href="http://www.specificfeeds.com/widgets/emailSubscribeEncFeed/ZzdZSjZabnh0K1pPdFdIc3Ftb2pDa1hiTUk3OFI1dnJaR2VaQ1ZOQTIvWVU2cnJpMWFZcWYyL0t5VGZFQUZZVFRqZm9HNXZRZVMzcWttN3RMVEtlL0ZyY1NrVU93OHM0MjM2dlY0NWpyVlYrV1VXR3ZiN0p4QUwvT1BBTEVjajF8eHRhUEdic0c2elM0enNjTWkvNGFPVFkwYVhLSytZNy9Fd2RqYjlTL1BqUT0=/OA==/" target=_blank><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=error></a></div><div class=sf_fb style=text-align:left;vertical-align:middle;width:98px><div class="fb-like fb_iframe_widget" data-href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ data-width=180 data-send=false data-show-faces=false data-action=like data-share=true data-layout=button fb-xfbml-state=rendered fb-iframe-plugin-query="action=like&amp;app_id=&amp;container_width=98&amp;href=https%3A%2F%2Fchrisstclair.co.uk%2F7-dangerous-mistakes-in-c-net-that-are-easy-to-make%2F&amp;layout=button&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;share=true&amp;show_faces=false&amp;width=180"><span style=vertical-align:bottom;width:120px;height:28px><iframe name=f3281dfd89537e width=180px height=1000px data-testid="fb:like Facebook Social Plugin" title="fb:like Facebook Social Plugin" frameborder=0 allowtransparency=true allowfullscreen scrolling=no allow=encrypted-media style=border:none;visibility:visible;width:120px;height:28px sandbox="allow-popups allow-top-navigation allow-top-navigation-by-user-activation" srcdoc="<!DOCTYPE html> <html lang=en id=facebook class=&quot;svg no_js&quot;><meta charset=utf-8><meta name=referrer content=origin-when-crossorigin id=meta_referrer><title>Facebook</title><style>body.plugin{background:transparent;font-family:Helvetica,Arial,sans-serif;line-height:1.28;overflow:hidden;-webkit-text-size-adjust:none}.plugin,.plugin td{font-size:11px}html{touch-action:manipulation}body{color:#1c1e21;direction:ltr;margin:0;padding:0;unicode-bidi:embed}td{font-family:Helvetica,Arial,sans-serif}a{color:#385898;cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}td{text-align:left}._2pi7{padding-left:4px;padding-right:4px}._2pir{padding-left:4px}._51mz{border:0;border-collapse:collapse;border-spacing:0}.uiGrid .vTop{vertical-align:top}.uiGrid .hCent{text-align:center}._51mx:first-child>._51m-{padding-top:0}._51mx:last-child>._51m-{padding-bottom:0}._51mz ._51mw{padding-right:0}._51mz ._51m-:first-child{padding-left:0}form{margin:0;padding:0}.inlineBlock{display:inline-block;zoom:1}._2tga{color:#fff;cursor:pointer;font-family:Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;margin:0;position:relative;-webkit-user-select:none;white-space:nowrap}._89n_{background:#1877f2;border:0}._2tga._8j9v{border-radius:3px;font-size:11px;height:20px;padding:0 6px}._2tga:hover{background:#365899;border:1px solid #365899}._89n_:hover{background:#1877f2;border:0}._2tga:active{background:#577fbc;border:1px solid #577fbc}._89n_:active{background:#1877f2;border:0}._2tga:focus{outline-color:transparent;outline-style:none}._8f1i{background-color:rgba(9,30,66);border-radius:inherit;height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}._8f1i:active{opacity:.3}._3jn-{height:16px;vertical-align:middle;width:16px}@keyframes burst{from{background-position:0 0}to{background-position:-616px 0}}._49vg{vertical-align:middle}._2tga ._49vg{display:inline-block;zoom:1}#facebook ._2tga span._49vh{font-family:Helvetica,Arial,sans-serif;vertical-align:middle}._49vh{font-weight:bold}._2tga ._1pbq{height:16px;width:16px}._2n-v ._49vh{padding-left:2px}._4mr9{-webkit-touch-callout:none;-webkit-user-select:none}._li._li._li{overflow:initial}.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content=&quot;default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;&quot;><body dir=ltr class=&quot;plugin _4mr9 chrome webkit win x1 Locale_en_US&quot;><div class=_li><div class=&quot;pluginSkinLight pluginFontHelvetica&quot;><div><table class=&quot;uiGrid _51mz&quot; cellspacing=0 cellpadding=0 id=u_0_0_p5 style=width:120px><tbody><tr class=_51mx><td class=&quot;_51m- vTop hCent&quot;><div><form rel=async ajaxify=/plugins/like/connect method=post action=/plugins/like/connect id=u_0_1_h1><button id=icon-button type=submit class=&quot;inlineBlock _2tga _89n_ _8j9v&quot; title=Like><span class=_8f1i></span><div><span class=&quot;_3jn- inlineBlock _2v7&quot;><span class=&quot;_3jn_ sf-hidden&quot;></span><span class=_49vg><svg xmlns=http://www.w3.org/2000/svg viewBox=&quot;0 0 16 16&quot; class=_1pbq color=#ffffff><path fill=#ffffff fill-rule=evenodd d=&quot;M4.55,7 C4.7984,7 5,7.23403636 5,7.52247273 L5,13.4775273
          C5,13.7659636 4.7984,14 4.55,14 L2.45,14 C2.2016,14 2,13.7659636
          2,13.4775273 L2,7.52247273 C2,7.23403636 2.2016,7 2.45,7 L4.55,7 Z
          M6.54470232,13.2 C6.24016877,13.1641086 6.01734614,12.8982791
          6,12.5737979 C6.01734614,12.5737979 6.01344187,9.66805666 6,8.14398693
          C6.01344187,7.61903931 6.10849456,6.68623352 6.39801308,6.27384278
          C7.10556287,5.26600749 7.60281698,4.6079584 7.89206808,4.22570082
          C8.18126341,3.8435016 8.52813047,3.4708734 8.53777961,3.18572676
          C8.55077527,2.80206854 8.53655255,2.79471518 8.53777961,2.35555666
          C8.53900667,1.91639814 8.74565444,1.5 9.27139313,1.5 C9.52544997,1.5
          9.7301456,1.55690094 9.91922413,1.80084547 C10.2223633,2.15596568
          10.4343097,2.71884727 10.4343097,3.60971169 C10.4343097,4.50057612
          9.50989975,6.1729303 9.50815961,6.18 C9.50815961,6.18
          13.5457098,6.17908951 13.5464084,6.18 C14.1635544,6.17587601
          14.5,6.72543196 14.5,7.29718426 C14.5,7.83263667 14.1341135,8.27897346
          13.6539433,8.3540827 C13.9452023,8.49286263 14.1544715,8.82364675
          14.1544715,9.20555417 C14.1544715,9.68159617 13.8293011,10.0782687
          13.3983805,10.1458495 C13.6304619,10.2907572 13.7736931,10.5516845
          13.7736931,10.847511 C13.7736931,11.2459343 13.5138356,11.5808619
          13.1594388,11.6612236 C13.3701582,11.7991865 13.5063617,12.0543945
          13.5063617,12.3429843 C13.5063617,12.7952155 13.1715421,13.1656844
          12.7434661,13.2 L6.54470232,13.2 Z&quot;></path></svg><img class=&quot;_1pbs inlineBlock img sf-hidden&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==&quot; alt width=16 height=16></span></span><span class=&quot;_49vh _2pi7&quot;>Like</span></div></button></form></div><td class=&quot;_51m- vTop _2pir _51mw&quot;><div><a class=_2vmz href=&quot;https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fchrisstclair.co.uk%2F7-dangerous-mistakes-in-c-net-that-are-easy-to-make%2F&amp;amp;display=popup&amp;amp;ref=plugin&amp;amp;src=like&amp;amp;kid_directed_site=0&quot; target=_blank id=u_0_2_MV><button id=icon-button type=submit class=&quot;inlineBlock _2tga _89n_ _8j9v&quot;><span class=_8f1i></span><div class=_2n-v><span class=&quot;_49vh _2pi7&quot;>Share</span></div></button></a></div></table><span id=jsbundle-loader>&amp;nbsp;</span></div></div></div>"></iframe></span></div></div><div class=sf_twiter style=text-align:left;float:left;vertical-align:middle;width:auto><iframe id=twitter-widget-0 scrolling=no frameborder=0 allowtransparency=true allowfullscreen class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" style=position:static;visibility:visible;width:73px;height:20px title="Twitter Tweet Button" data-url=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/ sandbox="allow-popups allow-top-navigation allow-top-navigation-by-user-activation" srcdoc="<!DOCTYPE html> <html data-scribe=page:button lang=en><meta charset=utf-8>
<title>Tweet Button</title>
<style>html{margin:0;padding:0;font:normal normal normal 12px/18px 'Helvetica Neue',Arial,sans-serif;color:#333;-webkit-user-select:none;-ms-user-select:none;-moz-user-select:none;user-select:none}body{margin:0;padding:0;background:0 0}a{outline:0;text-decoration:none}#widget{display:inline-block;white-space:nowrap;overflow:hidden;text-align:left}.btn,.btn .label,.btn-o{display:inline-block;vertical-align:top;zoom:1}.btn-o{max-width:100%}.btn{position:relative;height:20px;box-sizing:border-box;padding:1px 12px 1px 12px;background-color:#1d9bf0;color:#fff;border-radius:9999px;font-weight:500;cursor:pointer}.btn:active,.btn:focus,.btn:hover{background-color:#0c7abf}.btn:active{box-shadow:inset 0 3px 5px rgba(0,0,0,.1)}.btn i{position:relative;top:2px;display:inline-block;width:14px;height:14px;background:transparent 0 0 no-repeat;background-image:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2072%2072%22%3E%3Cpath%20fill%3D%22none%22%20d%3D%22M0%200h72v72H0z%22%2F%3E%3Cpath%20class%3D%22icon%22%20fill%3D%22%23fff%22%20d%3D%22M68.812%2015.14c-2.348%201.04-4.87%201.744-7.52%202.06%202.704-1.62%204.78-4.186%205.757-7.243-2.53%201.5-5.33%202.592-8.314%203.176C56.35%2010.59%2052.948%209%2049.182%209c-7.23%200-13.092%205.86-13.092%2013.093%200%201.026.118%202.02.338%202.98C25.543%2024.527%2015.9%2019.318%209.44%2011.396c-1.125%201.936-1.77%204.184-1.77%206.58%200%204.543%202.312%208.552%205.824%2010.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163%200%206.345%204.513%2011.638%2010.504%2012.84-1.1.298-2.256.457-3.45.457-.845%200-1.666-.078-2.464-.23%201.667%205.2%206.5%208.985%2012.23%209.09-4.482%203.51-10.13%205.605-16.26%205.605-1.055%200-2.096-.06-3.122-.184%205.794%203.717%2012.676%205.882%2020.067%205.882%2024.083%200%2037.25-19.95%2037.25-37.25%200-.565-.013-1.133-.038-1.693%202.558-1.847%204.778-4.15%206.532-6.774z%22%2F%3E%3C%2Fsvg%3E)}.btn .label{margin-left:3px;white-space:nowrap}</style>
<meta http-equiv=content-security-policy content=&quot;default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;&quot;></head>
<body data-scribe=section:share class=&quot;regular ltr ready&quot;>
<div id=widget>
 <div class=btn-o data-scribe=component:button style=width:73px><a href=&quot;https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Fcncc.bingj.com%2F&amp;amp;ref_src=twsrc%5Etfw%7Ctwcamp%5Ebuttonembed%7Ctwterm%5Eshare%7Ctwgr%5E&amp;amp;text=7%20dangerous%20mistakes%20in%20C%23%2F.NET%20that%20are%20easy%20to%20make&amp;amp;url=https%3A%2F%2Fchrisstclair.co.uk%2F7-dangerous-mistakes-in-c-net-that-are-easy-to-make%2F&quot; class=btn id=b><i></i><span class=label id=l>Tweet</span></a></div>
</div>
"></iframe></div><div class=sf_pinit style=text-align:left;vertical-align:middle;float:left;line-height:20px;width:47px><a href="https://www.pinterest.com/pin/create/button/?url=&amp;media=&amp;description=" data-pin-do=buttonPin data-pin-save=true data-pin-count=none></a></div></div></div>
 
 </div>
 
 </div>
 <footer class="entry-footer post-details">
 <div class=entry-categories> <svg class="icon icon-category" aria-hidden=true role=img> <use xlink:href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></use> </svg><a href=https://chrisstclair.co.uk/category/uncategorized/ rel="category tag">Uncategorized</a></div>
 <div class="entry-tags clearfix">
 <svg class="icon icon-tag" aria-hidden=true role=img> <use xlink:href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></use> </svg> <a href=https://chrisstclair.co.uk/tag/c/ rel=tag>c#</a>, <a href=https://chrisstclair.co.uk/tag/linq/ rel=tag>linq</a> </div>
 </footer>
</article>
 <nav class="navigation post-navigation" role=navigation>
 <h2 class=screen-reader-text>Post navigation</h2>
 <div class=nav-links><div class=nav-previous><a href=https://chrisstclair.co.uk/demystifying-async-await/ rel=prev><span class=nav-link-text>Previous Post</span><h3 class=entry-title>Demystifying Async/Await</h3></a></div><div class=nav-next><a href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/ rel=next><span class=nav-link-text>Next Post</span><h3 class=entry-title>Unit testing – Making existing code testable</h3></a></div></div>
 </nav>
<div id=comments class=comments-area>
 
 <h2 class=comments-title>
 3 thoughts on “<span>7 dangerous mistakes in C#/.NET that are easy to make</span>” </h2>
 
 <ol class=comment-list>
 <li id=comment-723 class="comment even thread-even depth-1">
 <article id=div-comment-723 class=comment-body>
 <footer class=comment-meta>
 <div class="comment-author vcard">
 <img alt src="data:image/png;base64,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" srcset class="avatar avatar-56 photo" height=56 width=56 data-sf-original-srcset="https://secure.gravatar.com/avatar/71c1027d2483fe242b0affc5e59df647?s=112&amp;d=mm&amp;r=g 2x" sizes> <b class=fn>Jonathan Allen</b> <span class=says>says:</span> </div>
 <div class=comment-metadata>
 <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/#comment-723>
 <time datetime=2019-09-24T18:58:48+00:00>
 September 24, 2019 at 18:58 </time>
 </a>
 </div>
 </footer>
 <div class=comment-content>
 <p>&gt; I’m not 100% sure of the reason why NULL values from the database are handled like this (please comment below if you know!), but Microsoft chose to represent them with a special type,</p>
<p>That’s the way it was done in Visual Basic in the pre-.NET era. VB 6 doesn’t have unified object model (everything inheriting from System.Object) or the concept of a “null”. There is `Nothing`, but that’s more like C#’s `default` than a true null.</p>
<p>So in VB 6 and ADO (probably DAO as well, I can’t remember), you have a value called DBNull to represent a database null, </p>
<p>The difference may seem academic, but DB nulls and null nulls have different semantics. Specifically I’m talking about strings. In VB, a null string is equal to an empty string. There’s no way to separate the two concepts in VB 6 and in VB 7+ (i.e. VB.NET) the different is still somewhat hidden.</p>
<p>Now I can’t say exactly why DBNull was carried into ADO.NET. Maybe backwards compatibility, maybe conceptual purity, maybe to deal with VB’s string handling. But I hope this story at least was interesting.</p>
 </div>
 <div class=reply><a rel=nofollow class=comment-reply-link href="https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/?replytocom=723#respond" aria-label="Reply to Jonathan Allen">Reply</a></div> </article>
</li>
 <li id=comment-724 class="comment odd alt thread-odd thread-alt depth-1">
 <article id=div-comment-724 class=comment-body>
 <footer class=comment-meta>
 <div class="comment-author vcard">
 <img alt src=data:image/jpeg;base64,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 srcset class="avatar avatar-56 photo" height=56 width=56 data-sf-original-srcset="https://secure.gravatar.com/avatar/1155eca64b64e5d71e04ab269e9cc7a8?s=112&amp;d=mm&amp;r=g 2x" sizes> <b class=fn>Jonas</b> <span class=says>says:</span> </div>
 <div class=comment-metadata>
 <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/#comment-724>
 <time datetime=2019-09-24T22:03:13+00:00>
 September 24, 2019 at 22:03 </time>
 </a>
 </div>
 </footer>
 <div class=comment-content>
 <p>As for DBNull, a tip is to use DataAdapter rather than icky low level DataReaders in case your result set is not huge. Then, after adapter.Fill(table), use the DataTable.Field() convenience method for strong typing and DBNull-awareness. Even supports nullable types!</p>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.data.datarowextensions.field?view=netframework-4.8" rel=nofollow>https://docs.microsoft.com/en-us/dotnet/api/system.data.datarowextensions.field?view=netframework-4.8</a></p>
 </div>
 <div class=reply><a rel=nofollow class=comment-reply-link href="https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/?replytocom=724#respond" aria-label="Reply to Jonas">Reply</a></div> </article>
</li>
 <li id=comment-785 class="comment even thread-even depth-1">
 <article id=div-comment-785 class=comment-body>
 <footer class=comment-meta>
 <div class="comment-author vcard">
 <img alt src=data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAOAA4AwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+t80Zo4o4oAM0ZrsPBvw7m8Sxi7uZDa2GcKwHzyeu30HvXdf8Kp0Dytnlz7v+ennHP8Ah+lAHiuaM12XjL4dTeG4jd2sjXViDhiR88f1x1HvXG8UAGaKOKKADI9Kkt4vtFxFEOC7Bc/U4qPJ9KVXZGDLwwOQaAPpS0tY7G1ht4VCRRKEVcdABipc1meG9eh8RaRBeRMNzACRB1R+4/z2rU/OgCK5t47y3lgmUPFKpR1I6gjBr5uu4fst1NCefLdkz64OK+g/EWuQ+HtJnvJmHyjCIerv2Ar55klaWRnblmJJPqaAG5HpRRk+lFABzVnTtOutWvY7W0iMs8hwqj+Z9BVbB9a9o+GXhlNI0VL2VR9rvFD5PVY/4R+PX8vSgCfwX4EXwsDNJdSTXTrh1RisQ/Dv9T+QrrP89aT8qPyoA5Txr4FHilRNHdSQ3Ua4RHYtEfw7fUfrXjOo6dc6Tey2t3EYp4zgqf5j1FfSP5VxvxN8Mpq+jPfRKPtlmpfI6tH/ABD8Ov5+tAHi/NFGDRQBY060+3aja22f9dKsf5kD+tfSKIsaKigKqjAAHAFFFAC/j+lL+P6UUUAH4/pTXRZEZGG5WGCCOooooA+btRtPsOoXVtn/AFMrR/kSKKKKAP/Z srcset class="avatar avatar-56 photo" height=56 width=56 data-sf-original-srcset="https://secure.gravatar.com/avatar/2b7bac198b8d719b486d570bb8d5173b?s=112&amp;d=mm&amp;r=g 2x" sizes> <b class=fn>Fotis</b> <span class=says>says:</span> </div>
 <div class=comment-metadata>
 <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/#comment-785>
 <time datetime=2019-10-05T05:02:18+00:00>
 October 5, 2019 at 05:02 </time>
 </a>
 </div>
 </footer>
 <div class=comment-content>
 <p>Back in the old c# days there wasn’t a thing such as nullable ints, floats, dates and so on, so there was no way you could represent a db null value using those data types.</p>
 </div>
 <div class=reply><a rel=nofollow class=comment-reply-link href="https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/?replytocom=785#respond" aria-label="Reply to Fotis">Reply</a></div> </article>
</li>
 </ol>
 <div id=respond class=comment-respond>
 <h3 id=reply-title class=comment-reply-title>Leave a Reply <small><a rel=nofollow id=cancel-comment-reply-link href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/#respond style=display:none>Cancel reply</a></small></h3> <form action=https://chrisstclair.co.uk/wp-comments-post.php method=post id=commentform class=comment-form novalidate>
 <p class=comment-notes><span id=email-notes>Your email address will not be published.</span> Required fields are marked <span class=required>*</span><p class=comment-form-comment><label for=comment>Comment</label> <textarea id=comment name=comment cols=45 rows=8 maxlength=65525 required></textarea><p class=comment-form-author><label for=author>Name <span class=required>*</span></label> <input id=author name=author type=text value size=30 maxlength=245 required></p>
<p class=comment-form-email><label for=email>Email <span class=required>*</span></label> <input id=email name=email type=email value size=30 maxlength=100 aria-describedby=email-notes required></p>
<p class=comment-form-url><label for=url>Website</label> <input id=url name=url type=url value size=30 maxlength=200></p>
<p class=comment-form-cookies-consent><input id=wp-comment-cookies-consent name=wp-comment-cookies-consent type=checkbox value=yes><label for=wp-comment-cookies-consent>Save my name, email, and website in this browser for the next time I comment.</label></p>
<p class=form-submit><input name=submit type=submit id=submit class=submit value="Post Comment"> 
</p>
 <p class="antispam-group antispam-group-q" style=clear:both>
 <label>Current ye@r <span class=required>*</span></label>
 
 <input type=text name=antspm-q class="antispam-control antispam-control-q" value=5.5 autocomplete=off>
 </p>
 <p class="antispam-group antispam-group-e" style=display:none>
 
 
 </p>
 </form>
 </div>
 
</div>
 </main>
 </div>
 <section id=secondary class="sidebar widget-area clearfix" role=complementary>
 <section id=custom_html-3 class="widget_text widget widget_custom_html"><h4 class=widget-title>About</h4><div class="textwidget custom-html-widget"><div style=text-align:center>
 <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
</div>
I've been using C# since 2010, and wanted to start this blog to share what I've picked up along the way.</div></section><section id=search-2 class="widget widget_search">
<form role=search class=search-form action=https://chrisstclair.co.uk/>
 <label>
 <span class=screen-reader-text>Search for:</span>
 <input type=search class=search-field placeholder="Search …" value name=s title="Search for:">
 </label>
 <button type=submit class=search-submit>
 <svg class="icon icon-search" aria-hidden=true role=img> <use xlink:href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></use> </svg> <span class=screen-reader-text>Search</span>
 </button>
</form>
</section> <section id=recent-posts-2 class="widget widget_recent_entries"> <h4 class=widget-title>Recent Posts</h4> <ul>
 <li>
 <a href=https://chrisstclair.co.uk/6-lesser-known-features-of-c-net-that-you-should-be-using/>6 lesser-known features of C# / .NET that you should be using</a>
 </li>
 <li>
 <a href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/>Unit testing – Making existing code testable</a>
 </li>
 <li>
 <a href=https://chrisstclair.co.uk/7-dangerous-mistakes-in-c-net-that-are-easy-to-make/>7 dangerous mistakes in C#/.NET that are easy to make</a>
 </li>
 <li>
 <a href=https://chrisstclair.co.uk/demystifying-async-await/>Demystifying Async/Await</a>
 </li>
 <li>
 <a href=https://chrisstclair.co.uk/multithreading-made-easy-parallel-foreach/>Multithreading made easy – Parallel ForEach</a>
 </li>
 </ul>
 </section><section id=recent-comments-2 class="widget widget_recent_comments"><h4 class=widget-title>Recent Comments</h4><ul id=recentcomments><li class=recentcomments><span class=comment-author-link>Zev Spitz</span> on <a href=https://chrisstclair.co.uk/6-lesser-known-features-of-c-net-that-you-should-be-using/#comment-999>6 lesser-known features of C# / .NET that you should be using</a><li class=recentcomments><span class=comment-author-link>Steve Crane</span> on <a href=https://chrisstclair.co.uk/6-lesser-known-features-of-c-net-that-you-should-be-using/#comment-832>6 lesser-known features of C# / .NET that you should be using</a><li class=recentcomments><span class=comment-author-link>Leszek</span> on <a href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/#comment-827>Unit testing – Making existing code testable</a><li class=recentcomments><span class=comment-author-link>Leszek</span> on <a href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/#comment-826>Unit testing – Making existing code testable</a><li class=recentcomments><span class=comment-author-link>Pascal Ried</span> on <a href=https://chrisstclair.co.uk/unit-testing-making-existing-code-testable/#comment-825>Unit testing – Making existing code testable</a></ul></section><section id=categories-2 class="widget widget_categories"><h4 class=widget-title>Categories</h4> <ul>
 <li class="cat-item cat-item-10"><a href=https://chrisstclair.co.uk/category/best-practices/>Best Practices</a>
</li>
 <li class="cat-item cat-item-6"><a href=https://chrisstclair.co.uk/category/extension-methods/>Extension Methods</a>
</li>
 <li class="cat-item cat-item-14"><a href=https://chrisstclair.co.uk/category/miscellaneous/>Miscellaneous</a>
</li>
 <li class="cat-item cat-item-1"><a href=https://chrisstclair.co.uk/category/uncategorized/>Uncategorized</a>
</li>
 <li class="cat-item cat-item-2"><a href=https://chrisstclair.co.uk/category/vague-errors/>Vague Errors</a>
</li>
 </ul>
</section><section id=archives-2 class="widget widget_archive"><h4 class=widget-title>Archives</h4> <ul>
 <li><a href=https://chrisstclair.co.uk/2019/10/>October 2019</a></li>
 <li><a href=https://chrisstclair.co.uk/2019/09/>September 2019</a></li>
 <li><a href=https://chrisstclair.co.uk/2019/03/>March 2019</a></li>
 <li><a href=https://chrisstclair.co.uk/2019/02/>February 2019</a></li>
 <li><a href=https://chrisstclair.co.uk/2018/09/>September 2018</a></li>
 <li><a href=https://chrisstclair.co.uk/2018/08/>August 2018</a></li>
 <li><a href=https://chrisstclair.co.uk/2018/07/>July 2018</a></li>
 </ul>
 </section><section id=tag_cloud-3 class="widget widget_tag_cloud"><h4 class=widget-title>Tags</h4><div class=tagcloud><a href=https://chrisstclair.co.uk/tag/2100/ class="tag-cloud-link tag-link-8 tag-link-position-1" style=font-size:8pt aria-label="2100 (1 item)">2100</a>
<a href=https://chrisstclair.co.uk/tag/about/ class="tag-cloud-link tag-link-17 tag-link-position-2" style=font-size:8pt aria-label="about (1 item)">about</a>
<a href=https://chrisstclair.co.uk/tag/async/ class="tag-cloud-link tag-link-20 tag-link-position-3" style=font-size:8pt aria-label="async (1 item)">async</a>
<a href=https://chrisstclair.co.uk/tag/batch/ class="tag-cloud-link tag-link-7 tag-link-position-4" style=font-size:8pt aria-label="batch (1 item)">batch</a>
<a href=https://chrisstclair.co.uk/tag/c/ class="tag-cloud-link tag-link-3 tag-link-position-5" style=font-size:22pt aria-label="c# (10 items)">c#</a>
<a href=https://chrisstclair.co.uk/tag/entity-framework/ class="tag-cloud-link tag-link-22 tag-link-position-6" style=font-size:8pt aria-label="entity framework (1 item)">entity framework</a>
<a href=https://chrisstclair.co.uk/tag/ex/ class="tag-cloud-link tag-link-12 tag-link-position-7" style=font-size:8pt aria-label="ex (1 item)">ex</a>
<a href=https://chrisstclair.co.uk/tag/exceptions/ class="tag-cloud-link tag-link-11 tag-link-position-8" style=font-size:11.4054054054pt aria-label="exceptions (2 items)">exceptions</a>
<a href=https://chrisstclair.co.uk/tag/general/ class="tag-cloud-link tag-link-16 tag-link-position-9" style=font-size:8pt aria-label="general (1 item)">general</a>
<a href=https://chrisstclair.co.uk/tag/grouping/ class="tag-cloud-link tag-link-9 tag-link-position-10" style=font-size:8pt aria-label="grouping (1 item)">grouping</a>
<a href=https://chrisstclair.co.uk/tag/life/ class="tag-cloud-link tag-link-15 tag-link-position-11" style=font-size:8pt aria-label="life (1 item)">life</a>
<a href=https://chrisstclair.co.uk/tag/linq/ class="tag-cloud-link tag-link-5 tag-link-position-12" style=font-size:18.4054054054pt aria-label="linq (6 items)">linq</a>
<a href=https://chrisstclair.co.uk/tag/linq-to-sql/ class="tag-cloud-link tag-link-4 tag-link-position-13" style=font-size:15.5675675676pt aria-label="linq-to-sql (4 items)">linq-to-sql</a>
<a href=https://chrisstclair.co.uk/tag/parallel/ class="tag-cloud-link tag-link-19 tag-link-position-14" style=font-size:8pt aria-label="parallel (1 item)">parallel</a>
<a href=https://chrisstclair.co.uk/tag/threading/ class="tag-cloud-link tag-link-18 tag-link-position-15" style=font-size:11.4054054054pt aria-label="threading (2 items)">threading</a>
<a href=https://chrisstclair.co.uk/tag/unit-testing/ class="tag-cloud-link tag-link-21 tag-link-position-16" style=font-size:8pt aria-label="unit testing (1 item)">unit testing</a></div>
</section>
 </section>
 </div>
 
 <div id=footer class=footer-wrap>
 <footer id=colophon class="site-footer container clearfix" role=contentinfo>
 
 <div id=footer-line class=site-info>
 
 <span class=credit-link>
 WordPress Theme: <a href=https://themezee.com/themes/donovan/ title="Donovan WordPress Theme">Donovan</a> by ThemeZee. </span>
 </div>
 </footer>
 </div>
</div>
 
 <div id=fb-root class=fb_reset><div style=position:absolute;top:-10000px;width:0px;height:0px><div></div></div></div>
 
 
 
 
</div><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status=done style=display:none!important data-ad-status=unfilled></ins><iframe scrolling=no frameborder=0 allowtransparency=true title="Twitter settings iframe" style=display:none></iframe><iframe width=0 height=0 style=display:none></iframe><iframe id=rufous-sandbox scrolling=no frameborder=0 allowtransparency=true allowfullscreen style=position:absolute;visibility:hidden;display:none;width:0px;height:0px;padding:0px;border:none title="Twitter analytics iframe"></iframe><iframe id=google_esf name=google_esf style=display:none></iframe>